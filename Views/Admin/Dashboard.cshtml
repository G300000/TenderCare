@model IEnumerable<Project.Models.Appointment>

@{
    Layout = "_Layout";
    ViewData["Title"] = "Admin Dashboard";
}

<div class="admin-container" style="padding: 40px; background-color: #f4f7f6; min-height: 100vh;">

    <div style="margin-bottom: 30px; display: flex; justify-content: space-between; align-items: center;">
        <div>
            <h2 style="font-weight: 800; color: #2c3e50; margin: 0;"><i class="fas fa-chart-line"></i> Admin Dashboard</h2>
            <p style="color: #7f8c8d; font-size: 1.1rem;">Manage clinic appointments and patient history</p>
        </div>
        <div style="position: relative;">
            <input type="text" id="instantSearch" placeholder="Search name or ID..."
                   value="@ViewData["CurrentFilter"]"
                   style="padding: 12px 20px; border-radius: 30px; border: 1px solid #ddd; width: 300px; outline: none; box-shadow: 0 4px 6px rgba(0,0,0,0.05);">
            <i class="fas fa-search" style="position: absolute; right: 15px; top: 15px; color: #3498db;"></i>
        </div>
    </div>

    <div id="statsRow" style="display: flex; gap: 20px; margin-bottom: 40px;">
        <div style="flex: 1; background: white; padding: 20px; border-radius: 15px; border-top: 5px solid #3498db; box-shadow: 0 4px 6px rgba(0,0,0,0.05);">
            <h5 style="color: #7f8c8d; margin-bottom: 10px;">📅 Scheduled</h5>
            <h2 style="color: #3498db; margin: 0;">@Model.Count(a => a.Status == "Scheduled" || string.IsNullOrEmpty(a.Status))</h2>
        </div>
        <div style="flex: 1; background: white; padding: 20px; border-radius: 15px; border-top: 5px solid #2ecc71; box-shadow: 0 4px 6px rgba(0,0,0,0.05);">
            <h5 style="color: #7f8c8d; margin-bottom: 10px;">✅ Completed</h5>
            <h2 style="color: #2ecc71; margin: 0;">@Model.Count(a => a.Status == "Completed")</h2>
        </div>
        <div style="flex: 1; background: white; padding: 20px; border-radius: 15px; border-top: 5px solid #e74c3c; box-shadow: 0 4px 6px rgba(0,0,0,0.05);">
            <h5 style="color: #7f8c8d; margin-bottom: 10px;">❌ Cancelled</h5>
            <h2 style="color: #e74c3c; margin: 0;">@Model.Count(a => a.Status == "Cancelled")</h2>
        </div>
    </div>

    <div id="tableGrouping">
        <div class="table-card" style="background: white; border-radius: 15px; padding: 25px; margin-bottom: 40px; box-shadow: 0 4px 15px rgba(0,0,0,0.05);">
            <h3 style="color: #3498db; margin-bottom: 20px; font-weight: 700;">Scheduled Appointments</h3>
            @await Html.PartialAsync("_AppointmentTablePartial", Model.Where(a => a.Status == "Scheduled" || string.IsNullOrEmpty(a.Status)))
        </div>

        <div class="table-card" style="background: white; border-radius: 15px; padding: 25px; margin-bottom: 40px; box-shadow: 0 4px 15px rgba(0,0,0,0.05);">
            <h3 style="color: #2ecc71; margin-bottom: 20px; font-weight: 700;">Completed History</h3>
            @await Html.PartialAsync("_AppointmentTablePartial", Model.Where(a => a.Status == "Completed"))
        </div>

        <div class="table-card" style="background: white; border-radius: 15px; padding: 25px; box-shadow: 0 4px 15px rgba(0,0,0,0.05);">
            <h3 style="color: #e74c3c; margin-bottom: 20px; font-weight: 700;">Cancelled</h3>
            @await Html.PartialAsync("_AppointmentTablePartial", Model.Where(a => a.Status == "Cancelled"))
        </div>
    </div>
</div>

@section Scripts {
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        $(document).ready(function () {
            $("#instantSearch").on("keyup", function () {
                var value = $(this).val();
                $.ajax({
                    url: '@Url.Action("Dashboard", "Admin")',
                    type: 'GET',
                    data: { searchString: value },
                    success: function (response) {
                        // Refresh all tables
                        $("#tableGrouping").html($(response).find("#tableGrouping").html());
                        // Refresh stat counters
                        $("#statsRow").html($(response).find("#statsRow").html());
                    }
                });
            });
        });
    </script>
}